from port_scanner import scan_ports
from cve_api_search import search_vulnerabilities
from web_scraper import scrape_extra_cve_info

def display_results(vuln_list):
    for vuln in vuln_list:
        print("\n==========================")
        print(f"🆔 CVE ID: {vuln['id']}")
        print(f"📝 Title: {vuln['title']}")
        print(f"📊 CVSS Score: {vuln['cvss']}")
        
        summary = scrape_extra_cve_info(vuln['id'])
        print(f"📃 Summary: {summary}")

if __name__ == "__main__":
    target = input("Enter target URL or IP: ").strip()
    port_scan_result = scan_ports(target)
    if "error" in port_scan_result:
        print(port_scan_result["error"])
        exit(1)
    open_ports = port_scan_result.get("open_ports", [])
    if not open_ports:
        print("No open ports found.")
        exit(0)
    for port_info in open_ports:
        banner = port_info.get("banner", "")
        service = port_info.get("service", "unknown")
        search_term = banner if banner else service
        if search_term == "unknown" or not search_term:
            print(f"❌ Could not detect service for port {port_info.get('port')}, skipping CVE lookup.")
            continue
        print(f"\nScanning for vulnerabilities for: {search_term} ...")
        vulns = search_vulnerabilities(search_term)
        if vulns and vulns.get('vulnerabilities'):
            display_results(vulns['vulnerabilities'][:5])
        else:
            print(f"❌ No vulnerabilities found for: {search_term}.")
